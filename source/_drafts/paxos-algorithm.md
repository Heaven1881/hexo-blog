---
title: Paxos算法介绍
tags:
  - paxos
  - 分布
  - 一致性
categories:
  - 分布式架构
---

Paxos是一个非常有名的一致性算法，其目的是为在网络中的各个进程提供信息同步的方法。之前对Paxos的了解一直很模糊，前段时间认真的把相关的论文看了一遍，总算才理解了Paxos的主要思想。现在特地记录下来。

<!-- more -->

# 问题背景

Paxos算法最早由[Leslie Lamport](https://en.m.wikipedia.org/wiki/Leslie_Lamport)提出。算法的核心问题就是如何让若干台机器在某一件事情上达成一致。假设有若干台机器(节点)，它们每隔一段时间就要共同选择出一个操作让所有节点执行。如果所有的节点初始状态都相同，我们可以推断出，经过一系列相同的操作后，所有节点仍然处于相同的状态。在这里，相同的状态就代表这些节点“达成一致”。

实际上，只要所有的节点都是用相同的方式进行初始化，那么它们的初始状态就必然相同，因此，我们只需要保证在初始化之后所有节点都执行的相同的操作序列，就可以保证最终所有节点的一致性。**既：对于任意正整数$n$，每个节点的第$n$个操作都是相同的**。这样，我们只需要保证节点可以对某一个操作达成一致即可，剩余的操作可以采用相同的方法。

在不同应用场景中，“操作”可以指代不同的内容。例如，对于数据库来说，“操作”可以代表每个数据库执行的SQL命令，如果数据库的初始状态相同，给不同的数据库发送相同的SQL命令序列，最终数据库的状态是相同的。

> 关于数据库的例子，需要注意的是：并不是所有的SQL命令序列都能保证最终数据库的状态一致。例如`INSERT INTO time VALUE(now())`向`time`表中插入一个时间戳，这里使用`now()`函数来获取当前时间，这条SQL命令产生的效果和其执行的时间有关。

# 相关概念
现在，我们的问题已经退化为如何让多个节点选择一个共同的操作。我们规定：每个节点可以进行3种操作：**提议(propose)**，**接受(accept)**，**学习(learn)**。三种行为的定义如下：

- **提议(propose)**：一个节点向剩余的所有节点建议接下来的操作。通俗的解释就是：一个节点和其他所有节点说：“我希望决定第n个操作，操作的内容如下...”。
- **接受(accept)**：一个节点接受另一个节点的**提议**。**接受**分为两个阶段，**初步接受**和**最终接受**，我们将在下面详细讨论。
- **学习(learn)**：网络异常可能导致一个节点失去连接，在这种情况下，节点会错过很多已经被**接受**的**提议**，这个时候节点可以通过**学习**向其它节点申请同步信息。


在Paxos中**提议(propose)**，**接受(accept)**和**学习(learn)**由三个模块来负责，分别是**提议者(proposer)**，**接受者(acceptor)**和**学习者(learner)**。一个节点既是**提议者(proposer)**，也是**接受者(acceptor)**和**学习者(learner)**，不同的角色由节点所处的状态决定。

**提议者**发送给**接受者**的内容称为**提议内容(proposal)**，每当提议者发送提议时，会在提议中附带一个编号，这个编号是全局唯一的，而且是递增的，在这里我们暂时不讨论如何实现这个编号。

# 算法流程

为了让所有的节点**接受**相同的**提议**，Paxos经过两个阶段来让所有节点都最终接受同一个提议。

## 阶段一
这一阶段提议者发出初步提议，

## 阶段二


---
> 本文欢迎转载，但是希望注明出处并给出原文链接。
> 如果你有任何疑问，欢迎在下方评论区留言，我会尽快答复。
> 如果你喜欢或者不喜欢这篇文章，欢迎你发邮件到[winton.luo@outlook.com](mailto:winton.luo@outlook.com)告诉我你的想法，你的建议对我非常重要。