---
title: Paxos：一致性算法简易教程
tags:
  - paxos
  - 分布式
  - 一致性
categories:
  - 分布式架构
---

Paxos是一个非常有名的一致性算法，其目的是为在网络中的各个进程提供信息同步的方法。之前对Paxos的了解一直很模糊，前段时间认真的把相关的论文看了一遍，总算才理解了Paxos的主要思想。现在特地记录下来。

<!-- more -->

# 前言
关于Paxos的详细介绍，可以参考这篇论文：[Paxos Made Simple by Lamport](http://research.microsoft.com/en-us/um/people/lamport/pubs/paxos-simple.pdf)。

对Paxos算法有一定了解的人一定会知道Paxos算法里面有Proposer，Acceptor和Learner三种角色。但这篇文章不会从这三个角度切入，我会直接从单个机器节点的角度来介绍Paxos算法。

# 问题背景
首先Paxos算法的目的就是要保证通过网络连接的多台机器之间数据的一致性。很多互联网公司(例如淘宝和京东)都需要24小时不间断的对外提供服务，这就要求其对应的数据库服务也必须24小时不间断的提供服务，但是对于单台机器来说这是不可能的，因为世界上没有一台机器可以保证永远不会宕机，而且也不能保证其对外服务的网络永远不出问题，大多数情况下，让一台机器恢复正常的时间很有可能需要数个小时甚至数天，因此，这些互联网公司需要在不同的网络部署多台机器，以便在其中一台机器出问题时，其他的机器仍然可以提供服务。这也就是我们现在经常听到的分布式结构。

<!-- 这里添加一张多个服务器同时服务的示例图 -->

分布式结构固然有很多优点，但是也带来了很多问题，其中一个问题就是如何维持不同节点之间的数据一致性。

我们先来简单解释一下为什么要保证不同节点之间的一致性。因为我们使用分布式的目的就是希望在一台机器出现问题时，尽快地将流量切换到另一台，因此两台机器上的数据必须时刻保持一致，否则在切换机器时会造成数据丢失。

那么如何保证分布式架构的一致性呢？这就是Paxos算法需要做的事情了。

# 强一致性算法

Paxos算法是非常经典的分布式一致性算法，它的目标是保持分布式结构的强一致性。

> **关于强一致性与最终一致性？**
> 目前业界对一致性的界定主要分为强一致性与最终一致性。强一致性要求所有节点任意时刻的数据都是完全一致的，而最终一致性不要求节点数据时刻保持一致，只要保证各个节点的数据最终是一致的即可。

假设有$n$台机器负责数据库服务，在初始的时候所有机器上的数据库都是空的，现在我们需要保证我在任意一个机器上做的数据操作都能同步到其他机器上。也就是说，所有的机器要同时收到并执行我的数据操作指令(在这里，我们不妨假设操作数据库的指令就是是SQL命令)。我们可以发现，因为每个机器初始的数据状态是一致的，只要他们执行的指令序列完全相同，那么他们数据状态仍然是一致的。

<!-- 插图：展现通过指令队列计算当前数据状态的例子 -->

现在，为了保证各个节点的数据一致，我们只需要保证每个节点上操作数据的命令是一致的即可。为了更简单的介绍Paxos算法，我们接下来假设有一个Client节点和若干个Server节点，Server节点就是我们的数据库节点，Client节点的主要工作就是要对Server节点负责的数据库进行读写操作(这里我们只考虑写操作，因为读操作不会破坏节点的一致性)。需要注意的是，Server节点的数量最少为3，我们会在下面介绍具体原因。

<!-- 配图：一个Client节点和若干个Server节点 -->

要保证每个节点执行命令序列的一致，我们只需要了解如何保证其中一条命令的一致性。例如，现在Client节点需要向Server节点提交第$m$条命令。假设当前状态下，所有的Server节点都已经知道第1条命令到第$m-1$条命令的内容了，那么在Paxos中，第$m$条命令会经历两个阶段：

- 提交阶段
- 应用阶段

## 提交阶段

## 应用阶段

# Paxos如何保持一致性

<!-- 多个Client节点 -->

<!-- Server节点从宕机回复 -->



---
> 本文欢迎转载，但是希望注明出处并给出原文链接。
> 如果你有任何疑问，欢迎在下方评论区留言，我会尽快答复。
> 如果你喜欢或者不喜欢这篇文章，欢迎你发邮件到[winton.luo@outlook.com](mailto:winton.luo@outlook.com)告诉我你的想法，你的建议对我非常重要。